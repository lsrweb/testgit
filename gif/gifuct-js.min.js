!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("gifuctJs",[],r):"object"==typeof exports?exports.gifuctJs=r():e.gifuctJs=r()}(this,(function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=3)}([function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.loop=r.conditional=r.parse=void 0;r.parse=function e(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(Array.isArray(t))t.forEach((function(t){return e(r,t,n,o)}));else if("function"==typeof t)t(r,n,o,e);else{var i=Object.keys(t)[0];Array.isArray(t[i])?(o[i]={},e(r,t[i],n,o[i])):o[i]=t[i](r,n,o,e)}return n};r.conditional=function(e,r){return function(t,n,o,i){r(t,n,o)&&i(t,e,n,o)}};r.loop=function(e,r){return function(t,n,o,i){for(var a=[],u=t.pos;r(t,n,o);){var d={};if(i(t,e,n,d),t.pos===u)break;u=t.pos,a.push(d)}return a}}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.readBits=r.readArray=r.readUnsigned=r.readString=r.peekBytes=r.readBytes=r.peekByte=r.readByte=r.buildStream=void 0;r.buildStream=function(e){return{data:e,pos:0}};var n=function(){return function(e){return e.data[e.pos++]}};r.readByte=n;r.peekByte=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(r){return r.data[r.pos+e]}};var o=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};r.readBytes=o;r.peekBytes=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};r.readString=function(e){return function(r){return Array.from(o(e)(r)).map((function(e){return String.fromCharCode(e)})).join("")}};r.readUnsigned=function(e){return function(r){var t=o(2)(r);return e?(t[1]<<8)+t[0]:(t[0]<<8)+t[1]}};r.readArray=function(e,r){return function(t,n,i){for(var a="function"==typeof r?r(t,n,i):r,u=o(e),d=new Array(a),c=0;c<a;c++)d[c]=u(t);return d}};r.readBits=function(e){return function(r){for(var t=function(e){return e.data[e.pos++]}(r),n=new Array(8),o=0;o<8;o++)n[7-o]=!!(t&1<<o);return Object.keys(e).reduce((function(r,t){var o=e[t];return o.length?r[t]=function(e,r,t){for(var n=0,o=0;o<t;o++)n+=e[r+o]&&Math.pow(2,t-o-1);return n}(n,o.index,o.length):r[t]=n[o.index],r}),{})}}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=t(0),o=t(1),i={blocks:function(e){for(var r=[],t=e.data.length,n=0,i=(0,o.readByte)()(e);0!==i&&i;i=(0,o.readByte)()(e)){if(e.pos+i>=t){var a=t-e.pos;r.push((0,o.readBytes)(a)(e)),n+=a;break}r.push((0,o.readBytes)(i)(e)),n+=i}for(var u=new Uint8Array(n),d=0,c=0;c<r.length;c++)u.set(r[c],d),d+=r[c].length;return u}},a=(0,n.conditional)({gce:[{codes:(0,o.readBytes)(2)},{byteSize:(0,o.readByte)()},{extras:(0,o.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,o.readUnsigned)(!0)},{transparentColorIndex:(0,o.readByte)()},{terminator:(0,o.readByte)()}]},(function(e){var r=(0,o.peekBytes)(2)(e);return 33===r[0]&&249===r[1]})),u=(0,n.conditional)({image:[{code:(0,o.readByte)()},{descriptor:[{left:(0,o.readUnsigned)(!0)},{top:(0,o.readUnsigned)(!0)},{width:(0,o.readUnsigned)(!0)},{height:(0,o.readUnsigned)(!0)},{lct:(0,o.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,n.conditional)({lct:(0,o.readArray)(3,(function(e,r,t){return Math.pow(2,t.descriptor.lct.size+1)}))},(function(e,r,t){return t.descriptor.lct.exists})),{data:[{minCodeSize:(0,o.readByte)()},i]}]},(function(e){return 44===(0,o.peekByte)()(e)})),d=(0,n.conditional)({text:[{codes:(0,o.readBytes)(2)},{blockSize:(0,o.readByte)()},{preData:function(e,r,t){return(0,o.readBytes)(t.text.blockSize)(e)}},i]},(function(e){var r=(0,o.peekBytes)(2)(e);return 33===r[0]&&1===r[1]})),c=(0,n.conditional)({application:[{codes:(0,o.readBytes)(2)},{blockSize:(0,o.readByte)()},{id:function(e,r,t){return(0,o.readString)(t.blockSize)(e)}},i]},(function(e){var r=(0,o.peekBytes)(2)(e);return 33===r[0]&&255===r[1]})),s=(0,n.conditional)({comment:[{codes:(0,o.readBytes)(2)},i]},(function(e){var r=(0,o.peekBytes)(2)(e);return 33===r[0]&&254===r[1]})),f=[{header:[{signature:(0,o.readString)(3)},{version:(0,o.readString)(3)}]},{lsd:[{width:(0,o.readUnsigned)(!0)},{height:(0,o.readUnsigned)(!0)},{gct:(0,o.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,o.readByte)()},{pixelAspectRatio:(0,o.readByte)()}]},(0,n.conditional)({gct:(0,o.readArray)(3,(function(e,r){return Math.pow(2,r.lsd.gct.size+1)}))},(function(e,r){return r.lsd.gct.exists})),{frames:(0,n.loop)([a,c,s,u,d],(function(e){var r=(0,o.peekByte)()(e);return 33===r||44===r}))}];r.default=f},function(e,r,t){"use strict";t.r(r),t.d(r,"parseGIF",(function(){return u})),t.d(r,"parseGIFFromBase64",(function(){return d})),t.d(r,"parseGIFFromFile",(function(){return c})),t.d(r,"decompressFrame",(function(){return s})),t.d(r,"decompressFrames",(function(){return f}));var n=t(2),o=t.n(n),i=t(0),a=t(1),u=function(e){var r=new Uint8Array(e);return Object(i.parse)(Object(a.buildStream)(r),o.a)},d=function(e){for(var r=e.replace(/^data:image\/gif;base64,/,""),t=atob(r),n=t.length,o=new Uint8Array(n),i=0;i<n;i++)o[i]=t.charCodeAt(i);return u(o.buffer)},c=function(e){return new Promise((function(r,t){if(e instanceof Blob){var n=new FileReader;n.onload=function(e){try{var n=u(e.target.result);r(n)}catch(e){t(e)}},n.onerror=function(){return t(new Error("读取文件失败"))},n.readAsArrayBuffer(e)}else t(new Error("参数必须是 File 或 Blob 类型"))}))},s=function(e,r,t){if(e.image){var n=e.image,o=n.descriptor.width*n.descriptor.height,i=function(e,r,t){var n,o,i,a,u,d,c,s,f,l,p,y,g,v,h,b,m=t,x=new Array(t),B=new Array(4096),w=new Array(4096),A=new Array(4097);for(u=(o=1<<(l=e))+1,n=o+2,c=-1,i=(1<<(a=l+1))-1,s=0;s<o;s++)B[s]=0,w[s]=s;for(p=y=g=v=h=b=0,f=0;f<m;){if(0===v){if(y<a){p+=r[b]<<y,y+=8,b++;continue}if(s=p&i,p>>=a,y-=a,s>n||s==u)break;if(s==o){i=(1<<(a=l+1))-1,n=o+2,c=-1;continue}if(-1==c){A[v++]=w[s],c=s,g=s;continue}for(d=s,s==n&&(A[v++]=g,s=c);s>o;)A[v++]=w[s],s=B[s];g=255&w[s],A[v++]=g,n<4096&&(B[n]=c,w[n]=g,0==(++n&i)&&n<4096&&(a++,i+=n)),c=d}v--,x[h++]=A[v],f++}for(f=h;f<m;f++)x[f]=0;return x}(n.data.minCodeSize,n.data.blocks,o);n.descriptor.lct.interlaced&&(i=function(e,r){for(var t=new Array(e.length),n=e.length/r,o=function(n,o){var i=e.slice(o*r,(o+1)*r);t.splice.apply(t,[n*r,r].concat(i))},i=[0,4,2,1],a=[8,8,4,2],u=0,d=0;d<4;d++)for(var c=i[d];c<n;c+=a[d])o(c,u),u++;return t}(i,n.descriptor.width));var a={pixels:i,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?a.colorTable=n.lct:a.colorTable=r,e.gce&&(a.delay=10*(e.gce.delay||10),a.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(a.transparentIndex=e.gce.transparentColorIndex)),t&&(a.patch=function(e){for(var r=e.pixels.length,t=new Uint8ClampedArray(4*r),n=0;n<r;n++){var o=4*n,i=e.pixels[n],a=e.colorTable[i]||[0,0,0];t[o]=a[0],t[o+1]=a[1],t[o+2]=a[2],t[o+3]=i!==e.transparentIndex?255:0}return t}(a)),a}console.warn("gif frame does not have associated image.")},f=function(e,r){return e.frames.filter((function(e){return e.image})).map((function(t){return s(t,e.gct,r)}))}}])}));